{"version":3,"sources":["../src/adaptive-content-grid.jsx"],"names":["AdaptiveGridItem","ContentContainer","props","paddingTop","paddingBottom","verticalAlign","contentGap","expandableContainerRef","display","width","position","onContentResize","children","EmptyComponent","AdaptiveGrid","newChildren","map","mapChildren","style","visible","visibility","adaptiveGrid","adaptiveGridRef","baseWidth","baseHeight","maxColumns","child","i","type","minHeight","needsResizing","undefined","nextChild","Array","isArray","NextChildComponent","nextChildAttributes","nextChildChildren","containerHeight","state","contentHeight","padding","fullHeight","Math","ceil","refs","containerRef","element","container","expandableContainer","length","console","log","bind","bindAll","self","window","requestAnimationFrame","forceUpdate","w","h","makeVisible","slice","clientHeight","setState","Component"],"mappings":"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","file":"adaptive-content-grid.js","sourcesContent":["import React from 'react';\r\nimport ResizeSensor from 'resize-sensor--react';\r\nimport { AdaptiveGrid as DefaultAdaptiveGrid, AdaptiveGridItem } from './adaptive-grid';\r\n\r\nexport { AdaptiveGridItem };\r\n\r\n// wraps content of a grid into an expandable container and content container\r\n// and adds resize sensor on the content container\r\nfunction ContentContainer(props) {\r\n  var paddingTop, paddingBottom;\r\n  if (props.verticalAlign === 'middle') {\r\n    paddingTop = props.contentGap / 2;\r\n    paddingBottom = props.contentGap / 2;\r\n  }\r\n  else if (props.verticalAlign === 'bottom') {\r\n    paddingTop = props.contentGap;\r\n    paddingBottom = 0;\r\n  }\r\n  else {\r\n    paddingTop = 0;\r\n    paddingBottom = props.contentGap;\r\n  }\r\n  return (\r\n    <div\r\n      ref={props.expandableContainerRef}\r\n      style={{\r\n        display: 'inline-block',\r\n        width: '100%',\r\n        position: 'relative',\r\n        paddingTop: (paddingTop + 'px'),\r\n        paddingBottom: (paddingBottom + 'px')\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          display: 'inline-block',\r\n          width: '100%',\r\n          position: 'relative'\r\n        }}\r\n      >\r\n        <ResizeSensor onResize={props.onContentResize} />\r\n        {props.children}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// This component doesn't really matter\r\nfunction EmptyComponent(props) {\r\n  return <div>{ props.children }</div>;\r\n};\r\n\r\n// this grid composes the regular adaptive grid to add the 'content' functionality\r\nexport class AdaptiveGrid extends React.Component {\r\n  render() {\r\n    var\r\n      newChildren = this.props.children.map(this.mapChildren),\r\n      style = this.visible ? {} : {\r\n        visibility: 'hidden'\r\n      }\r\n    ;\r\n    return (\r\n      <div style={style}>\r\n        <DefaultAdaptiveGrid\r\n          ref={(adaptiveGrid) => this.adaptiveGridRef = adaptiveGrid}\r\n          baseWidth={this.props.baseWidth}\r\n          baseHeight={this.props.baseHeight}\r\n          maxColumns={this.props.maxColumns}\r\n        >\r\n          { newChildren }\r\n        </DefaultAdaptiveGrid>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  mapChildren(child, i) {\r\n    if(!(this.props.baseWidth > 0))\r\n      return child\r\n    ;\r\n    if(!(this.props.baseHeight > 0))\r\n      return child\r\n    ;\r\n    if (child.type !== AdaptiveGridItem)\r\n      return child\r\n    ;\r\n    if (!child.props)\r\n      return child\r\n    ;\r\n    if (child.props.minHeight !== 'content')\r\n      return child\r\n    ;\r\n    if (this.needsResizing === undefined) {\r\n      this.needsResizing = true;\r\n      this.visible = false;\r\n    }\r\n    var\r\n      nextChild = Array.isArray(child.props.children) ? child.props.children[0] : child.props.children\r\n    ,\r\n      NextChildComponent = nextChild ? nextChild.type : undefined\r\n    ,\r\n      nextChildAttributes = nextChild ? nextChild.props : undefined\r\n    ,\r\n      nextChildChildren = nextChild ? nextChild.props.children : undefined\r\n    ,\r\n      containerHeight = this.state.contentHeight[i] + this.state.padding[i]\r\n    ,\r\n      minHeight = (containerHeight || this.props.baseHeight)\r\n    ,\r\n      fullHeight = Math.ceil(minHeight / this.props.baseHeight) * this.props.baseHeight\r\n    ,\r\n      refs = {}\r\n    ,\r\n      containerRef = function(element) {\r\n        refs.container = element\r\n      }\r\n    ,\r\n      expandableContainerRef = function(element) {\r\n        refs.expandableContainer = element\r\n      }\r\n    ;\r\n    // Edge case for when there's no container for the content provided\r\n    if (typeof nextChild === 'string' || (Array.isArray(child.props.children) && child.props.children.length !== 1)) {\r\n      console.log('true');\r\n      nextChild = <div>{ child.props.children }</div>;\r\n      NextChildComponent = nextChild.type;\r\n      nextChildAttributes = nextChild.props;\r\n      nextChildChildren = nextChild.props.children;\r\n    }\r\n    return (\r\n      <AdaptiveGridItem\r\n        {...child.props}\r\n        key={i}\r\n        minHeight={minHeight}\r\n      >\r\n        <div ref={containerRef}>\r\n          <NextChildComponent {...nextChildAttributes}>\r\n            <ContentContainer\r\n              expandableContainerRef={expandableContainerRef}\r\n              contentGap={fullHeight - minHeight}\r\n              verticalAlign={child.props.verticalAlign}\r\n              onContentResize={this.onContentResize(i, refs)}\r\n            >\r\n              {nextChildChildren}\r\n            </ContentContainer>\r\n          </NextChildComponent>\r\n        </div>\r\n      </AdaptiveGridItem>\r\n    )\r\n  }\r\n\r\n  bindAll() {\r\n    this.mapChildren = this.mapChildren.bind(this);\r\n    this.onContentResize = this.onContentResize.bind(this);\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.bindAll();\r\n    this.visible = true;\r\n    this.state = {contentHeight: [], padding: []};\r\n  }\r\n\r\n  // to avoid seeing overlap between grid items, we defer\r\n  // making grid visible by a few frames so that it has time\r\n  // to change sizes\r\n  makeVisible() {\r\n    var self = this;\r\n    window.requestAnimationFrame(function() {\r\n      window.requestAnimationFrame(function() {\r\n        window.requestAnimationFrame(function() {\r\n          self.visible = true;\r\n          self.forceUpdate();\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  // callback for when the content for an item is resized\r\n  onContentResize(i, refs) {\r\n    var self = this;\r\n    return function(w, h) {\r\n      if (self.needsResizing) {\r\n        self.needsResizing = false;\r\n        self.makeVisible();\r\n      }\r\n      var\r\n        contentHeight = self.state.contentHeight.slice()\r\n      ,\r\n        padding = self.state.padding.slice()\r\n      ;\r\n      contentHeight[i] = h;\r\n      // at initial render, the padding will be container - content\r\n      if (!(i in padding)) {\r\n        padding[i] = refs.container.clientHeight - h;\r\n      }\r\n      // at all further renders, the padding will be container - expanded content\r\n      else {\r\n        padding[i] = refs.container.clientHeight - refs.expandableContainer.clientHeight;\r\n      }\r\n      self.setState({\r\n        contentHeight: contentHeight,\r\n        padding: padding\r\n      });\r\n    };\r\n  }\r\n};"]}